<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Dossiers - Global News</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <i class="fas fa-file-alt"></i>
                <h1>Gestor de Dossiers</h1>
            </div>
            <p class="subtitle">Global News - Sistema de eliminación de dossiers</p>
        </header>

        <main class="main-content">
            <!-- Mostrar mensajes flash -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">
                                <i class="fas fa-{{ 'check-circle' if category == 'success' else 'exclamation-triangle' }}"></i>
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <div class="search-card">
                <div class="card-header">
                    <i class="fas fa-search"></i>
                    <h2>Eliminar Dossier Archivo</h2>
                </div>
                
                <form method="POST" action="{{ url_for('search') }}" class="search-form">
                    <div class="form-group">
                        <label for="dossier_archivo_id">ID del Dossier Archivo:</label>
                        <input 
                            type="number" 
                            id="dossier_archivo_id" 
                            name="dossier_archivo_id" 
                            placeholder="Ingresa el DossierArchivoID de la tabla inferior" 
                            required
                            min="1"
                            class="form-input"
                        >
                        <small class="form-help">Consulta la tabla de abajo para encontrar el ID correcto</small>
                    </div>
                    
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-search"></i>
                        Buscar Dossier Archivo
                    </button>
                </form>
            </div>

            <!-- Nueva tabla de dossiers en cola -->
            {% if dossiers_en_cola %}
            <div class="queue-table-card">
                <div class="card-header">
                    <i class="fas fa-list"></i>
                    <h2>Dossiers en Cola ({{ dossiers_en_cola|length }} registros)</h2>
                </div>
                
                <div class="table-container">
                    <div class="table-responsive">
                        <table class="queue-table">
                            <thead>
                                <tr>
                                    <th>DossierArchivoID</th>
                                    <th>Nombre</th>
                                    <th>Usuario</th>
                                    <th>Tipo</th>
                                    <th>Fecha Alta</th>
                                    <th>DossierID</th>
                                    <th>Cantidad</th>
                                    <th>Acción</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in dossiers_en_cola %}
                                <tr class="queue-row" data-archivo-id="{{ item.DossierArchivoID }}">
                                    <td class="archivo-id-cell">
                                        <strong>{{ item.DossierArchivoID }}</strong>
                                    </td>
                                    <td>{{ item.Nombre }}</td>
                                    <td>{{ item.UserName }}</td>
                                    <td>
                                        <span class="tipo-badge">{{ item.Tipo }}</span>
                                    </td>
                                    <td>{{ item.FechaAlta.strftime('%d/%m/%Y') if item.FechaAlta else 'N/A' }}</td>
                                    <td>{{ item.DossierID }}</td>
                                    <td>{{ item.Cantidad }}</td>
                                    <td>
                                        <button class="btn-copy" onclick="copyToInput('{{ item.DossierArchivoID }}')" title="Copiar ID al formulario">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="no-data-card">
                <div class="card-header">
                    <i class="fas fa-info-circle"></i>
                    <h3>Sin datos disponibles</h3>
                </div>
                <div class="no-data-content">
                    <i class="fas fa-database"></i>
                    <p>No se pudieron cargar los dossiers en cola o no hay registros disponibles.</p>
                    <p>Verifica la conexión a la base de datos.</p>
                </div>
            </div>
            {% endif %}

            <div class="info-card">
                <div class="card-header">
                    <i class="fas fa-info-circle"></i>
                    <h3>Información Importante</h3>
                </div>
                <ul class="info-list">
                    <li><i class="fas fa-shield-alt"></i> Esta herramienta elimina permanentemente los archivos del dossier</li>
                    <li><i class="fas fa-eye"></i> Se mostrará toda la información antes de confirmar la eliminación</li>
                    <li><i class="fas fa-history"></i> Todas las operaciones quedan registradas en el log del sistema</li>
                    <li><i class="fas fa-users"></i> Solo personal autorizado debe usar esta herramienta</li>
                </ul>
            </div>
        </main>

        <footer class="footer">
            <p>&copy; 2024 Global News - Desarrollado por Kevin Gómez</p>
            <p><i class="fas fa-heart" style="color: #e74c3c;"></i> Hecho con amor y Python</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>